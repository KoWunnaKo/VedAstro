@namespace Website.Pages
@using VedAstro.Library;
@using System.Xml.Linq


@*render, but visibily hide untill ready to show data*@
<div style="@(_isReadyToShow ? "" : "display: none;")">


    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item active" role="presentation">
            <button class="nav-link" id="aiPrediction-tab" data-bs-toggle="tab" data-bs-target="#aiPrediction" type="button" role="tab" aria-controls="aiPrediction" aria-selected="true">
                <Icon IconName="flat-color-icons:electronics" />
                <span class="mt-1">AI Prediction</span>
               
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="references-tab" data-bs-toggle="tab" data-bs-target="#references" type="button" role="tab" aria-controls="references" aria-selected="false">
                <Icon IconName="flat-color-icons:filing-cabinet" /><span class="mt-1">References</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="data-tab" data-bs-toggle="tab" data-bs-target="#data" type="button" role="tab" aria-controls="data" aria-selected="false">
                <Icon IconName="flat-color-icons:negative-dynamic" />
                <span class="mt-1">Data</span>
            </button>
        </li>
    </ul>
    <div class="tab-content border" id="myTabContent">

        @*AI PREDICTIONS CHART*@
        <div class="tab-pane fade show active" id="aiPrediction" role="tabpanel" aria-labelledby="aiPrediction-tab">
            <div class="vstack gap-3 p-4">
                <AIPrediction @ref="_aiPrediction" />
            </div>
        </div>

        @*MATCHED REFERENCE*@
        <div class="tab-pane fade" id="references" role="tabpanel" aria-labelledby="references-tab">
            <div class="vstack gap-2 p-2">

                @*LIST OF PREDICTIONS*@
                <HoroscopeReferenceList @ref="_horoscopeReferenceList" />

            </div>
        </div>

        @*ASTRO DATA CHART*@
        <div class="tab-pane fade" id="data" role="tabpanel" aria-labelledby="data-tab">
            <div class="vstack gap-3">
                @*only show when all is loaded*@
                <StrengthChart @ref="_strengthChart" />
                <hr>
                <PlanetHouseInfoViewer @ref="_planetHouseInfoViewer" />
            </div>
        </div>
    </div>


</div>


@code {
    private Person _selectedPerson = Person.Empty;
    private bool _isReadyToShow = false;

    private HoroscopeReferenceList _horoscopeReferenceList = null;
    private AIPrediction _aiPrediction = null;
    private PlanetHouseInfoViewer _planetHouseInfoViewer = null;
    private StrengthChart _strengthChart = null;



    /// <summary>
    /// Takes the inputed person and makes the visible chart
    /// starts the process
    /// </summary>
    public async Task SetPerson(Person selectedPerson)
    {
        //hide previous if any
        _isReadyToShow = false;

        //load planet & house data (from WASM)
        _selectedPerson = selectedPerson;

        //load prediction data (from API)
        await _horoscopeReferenceList.ShowPrediction(_selectedPerson);

        //show ai prediction
        await _aiPrediction?.ShowPrediction(_selectedPerson);

        await _planetHouseInfoViewer.Show(_selectedPerson);

        await _strengthChart.Show(_selectedPerson);

        //make visible
        _isReadyToShow = true;

        //need to make change visible
        StateHasChanged();

        //close loading box
        _jsRuntime.HideAlert();



        //---------------------------

    }




}
